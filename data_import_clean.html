<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />




<title>Data Sources and Overview</title>

<script src="site_libs/header-attrs-2.24/header-attrs.js"></script>
<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/yeti.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.13.2/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<link href="site_libs/highlightjs-9.12.0/default.css" rel="stylesheet" />
<script src="site_libs/highlightjs-9.12.0/highlight.js"></script>
<link href="site_libs/font-awesome-6.4.2/css/all.min.css" rel="stylesheet" />
<link href="site_libs/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>

<style type="text/css">code{white-space: pre;}</style>
<script type="text/javascript">
if (window.hljs) {
  hljs.configure({languages: []});
  hljs.initHighlightingOnLoad();
  if (document.readyState && document.readyState === "complete") {
    window.setTimeout(function() { hljs.initHighlighting(); }, 0);
  }
}
</script>






<link rel="stylesheet" href="styles.css" type="text/css" />



<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
details > summary > p:only-child {
  display: inline;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark the anchor link active (and if it's in a dropdown, also mark that active)
  var dropdown = menuAnchor.closest('li.dropdown');
  if (window.bootstrap) { // Bootstrap 4+
    menuAnchor.addClass('active');
    dropdown.find('> .dropdown-toggle').addClass('active');
  } else { // Bootstrap 3
    menuAnchor.parent().addClass('active');
    dropdown.addClass('active');
  }

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before, .tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "\e259";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "\e258";
  font-family: 'Glyphicons Halflings';
  border: none;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-default  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-bs-toggle="collapse" data-target="#navbar" data-bs-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">Home</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Data Sources
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="data_import_clean.html">Data Sources</a>
    </li>
    <li>
      <a href="latlong_to_zip.html">Coordinates to Zipcodes</a>
    </li>
  </ul>
</li>
<li>
  <a href="https://courtneyjdiamond.shinyapps.io/ExploratoryDashboard/">Exploratory Dashboard</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Analysis
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="analysis.html">Overall Analaysis</a>
    </li>
    <li>
      <a href="Exploration.html">Exploration of Variables</a>
    </li>
    <li>
      <a href="Modeling.html">Modeling</a>
    </li>
  </ul>
</li>
<li>
  <a href="project_report.html">Project Report</a>
</li>
<li>
  <a href="about_us.html">About Us</a>
</li>
<li>
  <a href="mailto:&lt;jl5934@cumc.columbia.edu&gt;">
    <span class="fa fa-envelope fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://github.com/courtneyjdiamond/p8105_final_project">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://citibikenyc.com/">
    <span class="fa fa-solid fa-bicycle"></span>
     
  </a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-show-all-code" href="#">Show All Code</a></li>
<li><a id="rmd-hide-all-code" href="#">Hide All Code</a></li>
</ul>
</div>



<h1 class="title toc-ignore"><span style="color: blue;">Data Sources and
Overview</span></h1>

</div>


<style>
  h1 {
     font-weight: bold;
  }
</style>
<p> </p>
<hr />
<div id="data-sources" class="section level2">
<h2><span style="color: blue;">Data Sources</span></h2>
<p><a
href="https://s3.amazonaws.com/tripdata/index.html"><strong>CitiBike
Data</strong></a>: These datasets contain monthly logs of trip,
including ride ID, the user’s status (subscriber or casual user), trip
start/end longitude/latitude coordinates, and the trip start/stop times
and duration.</p>
<p><a
href="https://www.graham-center.org/maps-data-tools/social-deprivation-index.html"><strong>Social
Deprivation Index</strong></a>: The social deprivation index (SDI) is an
effort to generate a scoring system of socioeconomic factors using US
census data from the American Community Survey. The final SDI is a
composite measure of percent living in poverty, percent with less than
12 years of education, percent single-parent households, the percentage
living in rented housing units, the percentage living in the overcrowded
housing unit, percent of households without a car, and percentage
nonemployed adults under 65 years of age. For more details please see
the webpage link.</p>
<p><a
href="https://a816-dohbesp.nyc.gov/IndicatorPublic/Subtopic.aspx?theme_code=2,3&amp;subtopic_id=113"><strong>Overweight
Data</strong></a>: This dataset contains publicly available data from
NYC regarding the percent of people who are overweight per area.</p>
<p><a
href="https://data.cityofnewyork.us/Environment/Air-Quality/c3uy-2p5r"><strong>Air
Quality Index Data</strong></a>: The air quality (AQ) data originated
from NYC Open Data, contributed by the Department of Hygiene and Mental
Health and include air quality indexes measured across boroughs in
NYC.</p>
<p> </p>
<hr />
</div>
<div id="invididual-dataset-imports-and-cleaning"
class="section level2">
<h2><span style="color: blue;">Invididual Dataset Imports and
Cleaning</span></h2>
<div id="citi-bike" class="section level3">
<h3>Citi Bike</h3>
<p>The Citi Bike data was a collection of csv files that we downloaded
and merged. At first, we were specifically interested in 2019 as this
was when SDI scores were available. We downloaded the data files from
December 2018 through January 2020.</p>
<p>A look at the raw data:</p>
<pre class="r"><code>citibike = 
  tibble(
    files = list.files(&quot;./citibike/&quot;),
    path = str_c(&quot;./citibike/&quot;, files)
  ) |&gt;
  mutate(data = map(path, ~read_csv(.x, col_types = cols(
    &#39;end station id&#39; = col_double(),
    &#39;start station id&#39; = col_double()
  )))) |&gt;
  unnest(cols = c(data))

citibike |&gt;
  head() |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="8%" />
<col width="11%" />
<col width="3%" />
<col width="5%" />
<col width="5%" />
<col width="5%" />
<col width="8%" />
<col width="6%" />
<col width="7%" />
<col width="4%" />
<col width="8%" />
<col width="6%" />
<col width="6%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">files</th>
<th align="left">path</th>
<th align="right">tripduration</th>
<th align="left">starttime</th>
<th align="left">stoptime</th>
<th align="right">start station id</th>
<th align="left">start station name</th>
<th align="right">start station latitude</th>
<th align="right">start station longitude</th>
<th align="right">end station id</th>
<th align="left">end station name</th>
<th align="right">end station latitude</th>
<th align="right">end station longitude</th>
<th align="right">bikeid</th>
<th align="left">usertype</th>
<th align="right">birth year</th>
<th align="right">gender</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">689</td>
<td align="left">2018-12-01 00:00:04</td>
<td align="left">2018-12-01 00:11:33</td>
<td align="right">3359</td>
<td align="left">E 68 St &amp; Madison Ave</td>
<td align="right">40.76916</td>
<td align="right">-73.96703</td>
<td align="right">164</td>
<td align="left">E 47 St &amp; 2 Ave</td>
<td align="right">40.75323</td>
<td align="right">-73.97033</td>
<td align="right">35033</td>
<td align="left">Subscriber</td>
<td align="right">1989</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">204</td>
<td align="left">2018-12-01 00:00:05</td>
<td align="left">2018-12-01 00:03:30</td>
<td align="right">3504</td>
<td align="left">E 123 St &amp; Lexington Ave</td>
<td align="right">40.80293</td>
<td align="right">-73.93790</td>
<td align="right">3490</td>
<td align="left">E 116 St &amp; 2 Ave</td>
<td align="right">40.79688</td>
<td align="right">-73.93726</td>
<td align="right">20501</td>
<td align="left">Subscriber</td>
<td align="right">1966</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">316</td>
<td align="left">2018-12-01 00:00:10</td>
<td align="left">2018-12-01 00:05:27</td>
<td align="right">270</td>
<td align="left">Adelphi St &amp; Myrtle Ave</td>
<td align="right">40.69308</td>
<td align="right">-73.97179</td>
<td align="right">243</td>
<td align="left">Fulton St &amp; Rockwell Pl</td>
<td align="right">40.68823</td>
<td align="right">-73.97938</td>
<td align="right">18386</td>
<td align="left">Subscriber</td>
<td align="right">1984</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">726</td>
<td align="left">2018-12-01 00:00:21</td>
<td align="left">2018-12-01 00:12:28</td>
<td align="right">495</td>
<td align="left">W 47 St &amp; 10 Ave</td>
<td align="right">40.76270</td>
<td align="right">-73.99301</td>
<td align="right">3660</td>
<td align="left">W 16 St &amp; 8 Ave</td>
<td align="right">40.74102</td>
<td align="right">-74.00138</td>
<td align="right">27616</td>
<td align="left">Subscriber</td>
<td align="right">1983</td>
<td align="right">1</td>
</tr>
<tr class="odd">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">397</td>
<td align="left">2018-12-01 00:00:29</td>
<td align="left">2018-12-01 00:07:07</td>
<td align="right">473</td>
<td align="left">Rivington St &amp; Chrystie St</td>
<td align="right">40.72110</td>
<td align="right">-73.99193</td>
<td align="right">3467</td>
<td align="left">W Broadway &amp; Spring Street</td>
<td align="right">40.72495</td>
<td align="right">-74.00166</td>
<td align="right">35096</td>
<td align="left">Subscriber</td>
<td align="right">1976</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">201812-citibike-tripdata.csv</td>
<td align="left">./citibike/201812-citibike-tripdata.csv</td>
<td align="right">299</td>
<td align="left">2018-12-01 00:00:30</td>
<td align="left">2018-12-01 00:05:30</td>
<td align="right">237</td>
<td align="left">E 11 St &amp; 2 Ave</td>
<td align="right">40.73047</td>
<td align="right">-73.98672</td>
<td align="right">237</td>
<td align="left">E 11 St &amp; 2 Ave</td>
<td align="right">40.73047</td>
<td align="right">-73.98672</td>
<td align="right">15087</td>
<td align="left">Customer</td>
<td align="right">1994</td>
<td align="right">1</td>
</tr>
</tbody>
</table>
<p>The cleaning of the Citi Bike data included the following steps:</p>
<ul>
<li>Recoding gender from numeric to text</li>
<li>Filtering trip duration to more than 5 minutes but less than 1 day
in order to capture true trips taken</li>
<li>Including trips that started in 2018 but ended in 2019 and trips
that started in 2019 but ended in 2020, so as to include all trips taken
in 2019</li>
<li>Creating an age at time of trip variable from birth year</li>
<li>Creating a trip duration in minutes (as opposed to seconds)
variable</li>
<li>Renaming variables</li>
</ul>
<p>Note: throughout the code chunks we have removed large dataframes to
save memory.</p>
<p>A look at the tidied dataframe:</p>
<pre class="r"><code>citibike_df = citibike |&gt;
  janitor::clean_names() |&gt;
  select(-files, -path) |&gt;
  mutate(month = as.factor(month(starttime))) |&gt;
  rename(trip_duration_sec = tripduration,
         start_time = starttime,
         stop_time = stoptime,
         user_type = usertype)|&gt;
  mutate(gender = recode(gender,
                         &quot;0&quot; = &quot;Unknown&quot;,
                         &quot;1&quot; = &quot;Male&quot;,
                         &quot;2&quot; = &quot;Female&quot;),
        trip_duration_min = trip_duration_sec / 60,
        age = 2019 - birth_year
        ) |&gt;
  filter(
    trip_duration_sec &gt;= 300,
    trip_duration_sec &lt;= 86400,
    as.Date(stop_time) &gt;= as.Date(&quot;2019-01-01&quot;),
    as.Date(start_time) &lt;= as.Date(&quot;2019-12-31&quot;)
  )  |&gt;
  select(trip_duration_sec, trip_duration_min, everything()) 

remove(citibike)

head(citibike_df) |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="6%" />
<col width="5%" />
<col width="9%" />
<col width="7%" />
<col width="8%" />
<col width="5%" />
<col width="8%" />
<col width="7%" />
<col width="7%" />
<col width="2%" />
<col width="3%" />
<col width="3%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">trip_duration_sec</th>
<th align="right">trip_duration_min</th>
<th align="left">start_time</th>
<th align="left">stop_time</th>
<th align="right">start_station_id</th>
<th align="left">start_station_name</th>
<th align="right">start_station_latitude</th>
<th align="right">start_station_longitude</th>
<th align="right">end_station_id</th>
<th align="left">end_station_name</th>
<th align="right">end_station_latitude</th>
<th align="right">end_station_longitude</th>
<th align="right">bikeid</th>
<th align="left">user_type</th>
<th align="right">birth_year</th>
<th align="left">gender</th>
<th align="left">month</th>
<th align="right">age</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">62663</td>
<td align="right">1044.3833</td>
<td align="left">2018-12-31 12:42:23</td>
<td align="left">2019-01-01 06:06:47</td>
<td align="right">3427</td>
<td align="left">Lafayette St &amp; Jersey St</td>
<td align="right">40.72431</td>
<td align="right">-73.99601</td>
<td align="right">529</td>
<td align="left">W 42 St &amp; 8 Ave</td>
<td align="right">40.75757</td>
<td align="right">-73.99099</td>
<td align="right">19573</td>
<td align="left">Customer</td>
<td align="right">2000</td>
<td align="left">Female</td>
<td align="left">12</td>
<td align="right">19</td>
</tr>
<tr class="even">
<td align="right">86324</td>
<td align="right">1438.7333</td>
<td align="left">2018-12-31 13:21:55</td>
<td align="left">2019-01-01 13:20:39</td>
<td align="right">458</td>
<td align="left">11 Ave &amp; W 27 St</td>
<td align="right">40.75140</td>
<td align="right">-74.00523</td>
<td align="right">127</td>
<td align="left">Barrow St &amp; Hudson St</td>
<td align="right">40.73172</td>
<td align="right">-74.00674</td>
<td align="right">16996</td>
<td align="left">Subscriber</td>
<td align="right">1953</td>
<td align="left">Female</td>
<td align="left">12</td>
<td align="right">66</td>
</tr>
<tr class="odd">
<td align="right">77833</td>
<td align="right">1297.2167</td>
<td align="left">2018-12-31 16:54:58</td>
<td align="left">2019-01-01 14:32:11</td>
<td align="right">3055</td>
<td align="left">Greene Ave &amp; Nostrand Ave</td>
<td align="right">40.68833</td>
<td align="right">-73.95092</td>
<td align="right">437</td>
<td align="left">Macon St &amp; Nostrand Ave</td>
<td align="right">40.68098</td>
<td align="right">-73.95005</td>
<td align="right">15420</td>
<td align="left">Customer</td>
<td align="right">1969</td>
<td align="left">Unknown</td>
<td align="left">12</td>
<td align="right">50</td>
</tr>
<tr class="even">
<td align="right">52587</td>
<td align="right">876.4500</td>
<td align="left">2018-12-31 17:37:05</td>
<td align="left">2019-01-01 08:13:33</td>
<td align="right">3457</td>
<td align="left">E 58 St &amp; Madison Ave</td>
<td align="right">40.76303</td>
<td align="right">-73.97210</td>
<td align="right">3457</td>
<td align="left">E 58 St &amp; Madison Ave</td>
<td align="right">40.76303</td>
<td align="right">-73.97210</td>
<td align="right">28349</td>
<td align="left">Subscriber</td>
<td align="right">1966</td>
<td align="left">Female</td>
<td align="left">12</td>
<td align="right">53</td>
</tr>
<tr class="odd">
<td align="right">76290</td>
<td align="right">1271.5000</td>
<td align="left">2018-12-31 18:00:44</td>
<td align="left">2019-01-01 15:12:14</td>
<td align="right">3521</td>
<td align="left">Lenox Ave &amp; W 111 St</td>
<td align="right">40.79879</td>
<td align="right">-73.95230</td>
<td align="right">3164</td>
<td align="left">Columbus Ave &amp; W 72 St</td>
<td align="right">40.77706</td>
<td align="right">-73.97898</td>
<td align="right">14710</td>
<td align="left">Subscriber</td>
<td align="right">1995</td>
<td align="left">Female</td>
<td align="left">12</td>
<td align="right">24</td>
</tr>
<tr class="even">
<td align="right">51131</td>
<td align="right">852.1833</td>
<td align="left">2018-12-31 18:40:45</td>
<td align="left">2019-01-01 08:52:56</td>
<td align="right">3581</td>
<td align="left">Underhill Ave &amp; Lincoln Pl</td>
<td align="right">40.67401</td>
<td align="right">-73.96715</td>
<td align="right">3576</td>
<td align="left">Park Pl &amp; Vanderbilt Ave</td>
<td align="right">40.67670</td>
<td align="right">-73.96902</td>
<td align="right">16935</td>
<td align="left">Customer</td>
<td align="right">1987</td>
<td align="left">Male</td>
<td align="left">12</td>
<td align="right">32</td>
</tr>
</tbody>
</table>
<p>The Citi Bike dataframe includes 16893163 trips and 18 variables. The
variables in the dataframe are trip_duration_sec, trip_duration_min,
start_time, stop_time, start_station_id, start_station_name,
start_station_latitude, start_station_longitude, end_station_id,
end_station_name, end_station_latitude, end_station_longitude, bikeid,
user_type, birth_year, gender, month, age.</p>
<p>Due to large sample size that limits technical processing
feasibility, we decided to focus on only one month of Citi Bike data. To
do so, we look at the distribution of number of rides by month. We chose
September as our month of focus because of the high ride volume.</p>
<p>Before limiting the data to September, we want to get a list of all
stations in the dataset for future exploration:</p>
<pre class="r"><code>start_station = citibike_df |&gt;
  distinct(start_station_id, start_station_name,
         start_station_latitude, start_station_longitude) |&gt;
  rename(
    station_id = start_station_id,
    station_name = start_station_name,
    latitude = start_station_latitude,
    longitude = start_station_longitude
  )

end_station = citibike_df |&gt;
  distinct(end_station_id, end_station_name,
         end_station_latitude, end_station_longitude) |&gt;
  rename(
    station_id = end_station_id,
    station_name = end_station_name,
    latitude = end_station_latitude,
    longitude = end_station_longitude
  )


stations = rbind(start_station, end_station) |&gt;
  unique() </code></pre>
<pre class="r"><code>citibike_df |&gt;
  group_by(month) |&gt;
  summarize(n_rides = n()) |&gt;
  arrange(month) |&gt;
  ggplot(aes(x = month, y = n_rides, group = 1)) +
  geom_point() +
  geom_line() </code></pre>
<p><img src="data_import_clean_files/figure-html/citibike_plot-1.png" width="90%" /></p>
<div id="filter-to-september" class="section level4">
<h4>Filter to September</h4>
<p>Since September is the month of highest usage, we focus on September
2019.</p>
<pre class="r"><code>citibike_df = citibike_df |&gt; filter(month == 9)</code></pre>
<p>The September 2019 Citi Bike dataframe includes 2069707 trips.</p>
<p> </p>
</div>
</div>
<div id="social-deprivation-index" class="section level3">
<h3>Social Deprivation Index</h3>
<p>The social deprivation index (SDI) dataset was a .csv. We renamed the
zipcode variable to be more intuitive. As we were only interested in the
entirety of the SDI score, we filtered the data to include zip code and
sdi_score only.</p>
<ul>
<li>Note: the higher the SDI score, the higher the social deprivation in
that area.</li>
</ul>
<p>A look at the tidied dataframe:</p>
<pre class="r"><code>SDI_df &lt;- read_csv(&quot;./data/SDI_data/rgcsdi-2015-2019-zcta.csv&quot;) |&gt;
  janitor::clean_names() |&gt;
  select(zcta5_fips, sdi_score)|&gt;
  rename(zip=zcta5_fips)

head(SDI_df) |&gt;
  knitr::kable()</code></pre>
<table>
<thead>
<tr class="header">
<th align="left">zip</th>
<th align="right">sdi_score</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">01001</td>
<td align="right">36</td>
</tr>
<tr class="even">
<td align="left">01002</td>
<td align="right">72</td>
</tr>
<tr class="odd">
<td align="left">01003</td>
<td align="right">76</td>
</tr>
<tr class="even">
<td align="left">01005</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">01007</td>
<td align="right">14</td>
</tr>
<tr class="even">
<td align="left">01008</td>
<td align="right">8</td>
</tr>
</tbody>
</table>
<p> </p>
</div>
<div id="overweight-data" class="section level3">
<h3>Overweight data</h3>
<p>The overweight data was downloaded as .csv files for “Overweight and
Obese Adults.” We were specifically interested in 2019 as this was when
SDI scores were available.</p>
<p>The cleaning of the overweight data included the following steps:</p>
<ul>
<li>Converting percent to a numeric variable</li>
<li>Separating out the high and low confidence intervals of percent</li>
<li>Renaming time to year</li>
<li>Filtering data to 2019</li>
</ul>
<p>A look at the tidied dataframe:</p>
<pre class="r"><code>overweight_df =
  read_csv(&#39;./data/SDI_data/nyc_overweight_or_obesity_adults.csv&#39;) |&gt;
  janitor::clean_names() |&gt;
  mutate(number = gsub(&quot;\\*&quot;, &quot;&quot;, number)) |&gt;
  mutate(number = gsub(&quot;,&quot;, &quot;&quot;, number)) |&gt;
  mutate(number = as.numeric(number)) |&gt;
  mutate(
    percent_low = as.numeric(gsub(&quot;^.*\\(\\s*&quot;, &quot;&quot;, gsub(&quot;\\s*,.*$&quot;, &quot;&quot;, percent))),
    percent_high = as.numeric(gsub(&quot;^.*\\,\\s*&quot;, &quot;&quot;, gsub(&quot;\\)$&quot;, &quot;&quot;, percent))),
percent = as.numeric(ifelse(grepl(&quot;\\*&quot;, percent),
                                gsub(&quot;\\*.*$&quot;, &quot;&quot;, percent),
                                gsub(&quot;\\s*\\(.*&quot;, &quot;&quot;, percent)))) |&gt;
  rename(year = time) |&gt;
  filter (year == 2019)

head(overweight_df) |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="5%" />
<col width="9%" />
<col width="7%" />
<col width="9%" />
<col width="27%" />
<col width="7%" />
<col width="8%" />
<col width="12%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">year</th>
<th align="left">geo_type</th>
<th align="right">geo_id</th>
<th align="right">geo_rank</th>
<th align="left">geography</th>
<th align="right">number</th>
<th align="right">percent</th>
<th align="right">percent_low</th>
<th align="right">percent_high</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">101</td>
<td align="right">3</td>
<td align="left">Kingsbridge - Riverdale</td>
<td align="right">37000</td>
<td align="right">52.4</td>
<td align="right">40.8</td>
<td align="right">63.8</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">102</td>
<td align="right">3</td>
<td align="left">Northeast Bronx</td>
<td align="right">103000</td>
<td align="right">69.6</td>
<td align="right">59.7</td>
<td align="right">78.0</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">103</td>
<td align="right">3</td>
<td align="left">Fordham - Bronx Pk</td>
<td align="right">122000</td>
<td align="right">71.1</td>
<td align="right">61.1</td>
<td align="right">79.3</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">104</td>
<td align="right">3</td>
<td align="left">Pelham - Throgs Neck</td>
<td align="right">152000</td>
<td align="right">66.4</td>
<td align="right">58.7</td>
<td align="right">73.4</td>
</tr>
<tr class="odd">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">201</td>
<td align="right">3</td>
<td align="left">Greenpoint</td>
<td align="right">40000</td>
<td align="right">41.8</td>
<td align="right">31.0</td>
<td align="right">53.6</td>
</tr>
<tr class="even">
<td align="right">2019</td>
<td align="left">UHF34</td>
<td align="right">202</td>
<td align="right">3</td>
<td align="left">Downtown - Heights - Slope</td>
<td align="right">86000</td>
<td align="right">50.8</td>
<td align="right">41.8</td>
<td align="right">59.7</td>
</tr>
</tbody>
</table>
<pre class="r"><code>#write_csv(overweight_df, &quot;data/SDI_data/overweight_data_clean.csv&quot;)</code></pre>
<p> </p>
</div>
<div id="air-quality" class="section level3">
<h3>Air Quality</h3>
<p>The air quality (AQ) data was a downloaded from .csv files.</p>
<p>The cleaning of the air quality index data included the following
steps:</p>
<ul>
<li>Extracting year from the date variable</li>
<li>Filtering data to 2019</li>
<li>Filtering to geolocation type UHF34, as this is consistent with our
other datasets (more on this below!)</li>
<li>Filtering to annual values, as this dataset also has seasonal
values</li>
<li>Filtering to Fine Particles (PM 2.5) (the original dataset also had
Nitrogen dioxide (NO2) and Ozone (O3). There were annual average values
for Nitrogen dioxide (NO2) and Fine Particles (PM 2.5) but only summer
average values for Ozone (O3) levels. For the purpose of only a single
value for AQ, we chose to use Fine Particles (PM 2.5) as the air quality
index.</li>
</ul>
<p>A look at the tidied dataset:</p>
<pre class="r"><code>air_quality_df = read_csv(&quot;./data/air_quality/Air_Quality_20231126.csv&quot;) |&gt;
  janitor::clean_names() |&gt;
  mutate(
    start_date = mdy(start_date),
    year = year(start_date)
  ) |&gt;
  filter(year == &quot;2019&quot;)

#Filter to only annual averages of fine particles (PM 2.5) mean measurement, mcg/m3
air_quality_df =   
  air_quality_df |&gt;
  filter(geo_type_name == &quot;UHF34&quot;) |&gt;
  filter(time_period == &quot;Annual Average 2019&quot;) |&gt;
  filter(name == &quot;Fine particles (PM 2.5)&quot;)

head(air_quality_df) |&gt;
  knitr::kable()</code></pre>
<table style="width:100%;">
<colgroup>
<col width="5%" />
<col width="7%" />
<col width="13%" />
<col width="4%" />
<col width="7%" />
<col width="7%" />
<col width="6%" />
<col width="16%" />
<col width="11%" />
<col width="6%" />
<col width="6%" />
<col width="4%" />
<col width="2%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">unique_id</th>
<th align="right">indicator_id</th>
<th align="left">name</th>
<th align="left">measure</th>
<th align="left">measure_info</th>
<th align="left">geo_type_name</th>
<th align="right">geo_join_id</th>
<th align="left">geo_place_name</th>
<th align="left">time_period</th>
<th align="left">start_date</th>
<th align="right">data_value</th>
<th align="left">message</th>
<th align="right">year</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">649819</td>
<td align="right">365</td>
<td align="left">Fine particles (PM 2.5)</td>
<td align="left">Mean</td>
<td align="left">mcg/m3</td>
<td align="left">UHF34</td>
<td align="right">207</td>
<td align="left">East Flatbush - Flatbush</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">6.31</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">649858</td>
<td align="right">365</td>
<td align="left">Fine particles (PM 2.5)</td>
<td align="left">Mean</td>
<td align="left">mcg/m3</td>
<td align="left">UHF34</td>
<td align="right">407</td>
<td align="left">Southwest Queens</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">6.19</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="odd">
<td align="right">649789</td>
<td align="right">365</td>
<td align="left">Fine particles (PM 2.5)</td>
<td align="left">Mean</td>
<td align="left">mcg/m3</td>
<td align="left">UHF34</td>
<td align="right">101</td>
<td align="left">Kingsbridge - Riverdale</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">6.71</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">649795</td>
<td align="right">365</td>
<td align="left">Fine particles (PM 2.5)</td>
<td align="left">Mean</td>
<td align="left">mcg/m3</td>
<td align="left">UHF34</td>
<td align="right">103</td>
<td align="left">Fordham - Bronx Pk</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">6.70</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="odd">
<td align="right">649882</td>
<td align="right">365</td>
<td align="left">Fine particles (PM 2.5)</td>
<td align="left">Mean</td>
<td align="left">mcg/m3</td>
<td align="left">UHF34</td>
<td align="right">501502</td>
<td align="left">Northern SI</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">6.05</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
<tr class="even">
<td align="right">649876</td>
<td align="right">365</td>
<td align="left">Fine particles (PM 2.5)</td>
<td align="left">Mean</td>
<td align="left">mcg/m3</td>
<td align="left">UHF34</td>
<td align="right">309310</td>
<td align="left">Union Square-Lower Manhattan</td>
<td align="left">Annual Average 2019</td>
<td align="left">2019-01-01</td>
<td align="right">8.67</td>
<td align="left">NA</td>
<td align="right">2019</td>
</tr>
</tbody>
</table>
<p>The AQ dataframe now includes 34 rows and 13 variables. The variables
in the dataframe are unique_id, indicator_id, name, measure,
measure_info, geo_type_name, geo_join_id, geo_place_name, time_period,
start_date, data_value, message, year.</p>
<hr />
</div>
</div>
<div id="nyc-neighborhood-data-merging" class="section level2">
<h2><span style="color: blue;">NYC Neighborhood Data Merging</span></h2>
<p>To combine datasets, they all need to have the same geographic
identifier. We decided to use United Hospital Fund (UHF) 34 codes which
consists of 34 adjoining zip codes with similar characteristics compiled
by the NYC government. We used UHF 34 instead of other UHF codes, such
as UHF 42, as UHF 34 had the least number of neighborhoods and is
therefore more comparable (contains the largest area per
neighborhood).</p>
<ul>
<li>For more information about the background behind UHF codes, please
see <a
href="https://a816-dohbesp.nyc.gov/IndicatorPublic/data-stories/geographies/"><strong>here</strong></a>.</li>
</ul>
<p>We did the following:</p>
<ol style="list-style-type: decimal">
<li><strong>UHF 42 to Zipcode</strong> First we converted UHF 42 codes
to zip codes, as the overweight dataframe included UHF 42 codes. We
found a table that mapped UHF 42 codes to zip codes from a NYC gov <a
href="https://www.nyc.gov/assets/doh/downloads/pdf/ah/zipcodetable.pdf"><strong>pdf</strong></a>.
Below we import this table and tidied it into a dataframe.</li>
</ol>
<pre class="r"><code>uhf_zip = 
  pdf_text(&quot;./data/geocoding/zipcodetable.pdf&quot;) |&gt; 
  extract(1)

uhf_zip_df =
  uhf_zip |&gt; 
  str_split(&quot;\n&quot;) |&gt;
  tibble() |&gt; 
  rename(&quot;data&quot; = &quot;str_split(uhf_zip, \&quot;\\n\&quot;)&quot;) |&gt; 
  unnest(&quot;data&quot;) |&gt; 
  filter(data != &quot;&quot;) |&gt; 
  filter(!row_number() %in% c(1, 2, 51)) |&gt; 
  filter(!row_number() %in% c(1, 2, 10, 22, 33, 44)) |&gt; 
  mutate(data = str_squish(data)) |&gt; 
  mutate(data = str_remove_all(data, &quot;-&quot;)) |&gt; 
  mutate(data = str_squish(data)) |&gt; 
  separate(data, into = c(&quot;uhf&quot;, &quot;rest&quot;), sep = &quot;(?&lt;=\\d\\s)&quot;) |&gt; 
  separate(col = &quot;rest&quot;, into = c(&quot;neighborhood&quot;, &quot;zip&quot;), sep = &quot;(?=\\s\\d)&quot;, extra = &quot;merge&quot;) |&gt; 
  separate(col = &quot;zip&quot;, into = c(&quot;zip1&quot;, &quot;zip2&quot;, &quot;zip3&quot;, &quot;zip4&quot;, &quot;zip5&quot;, &quot;zip6&quot;, &quot;zip7&quot;, &quot;zip8&quot;, &quot;zip9&quot;), sep = &quot;,&quot;) |&gt; 
  mutate(across(everything(), ~ str_trim(.x))) |&gt; 
  mutate(across(c(&quot;zip1&quot;:&quot;zip9&quot;), ~ as.numeric(.x))) |&gt; 
  mutate(uhf = as.numeric(uhf)) |&gt; 
  pivot_longer(c(zip1:zip9), names_to = &quot;zip_name&quot;, values_to = &quot;zip&quot;) |&gt; 
  filter(!is.na(zip)) |&gt; 
  select(!zip_name)</code></pre>
<ol start="2" style="list-style-type: decimal">
<li><strong>UHF 34 to UHF 42</strong> We imported and cleaned a
dataframe that converted UHF 34 to UHF 42 via neighborhood name. The
UHF34 source data were found <a
href="https://www.nyc.gov/assets/doh/downloads/pdf/tracking/uhf34.pdf"><strong>here</strong></a>.</li>
</ol>
<pre class="r"><code>uhf_34 = 
  pdf_text(&quot;./data/geocoding/uhf34.pdf&quot;)

uhf_34_df =
  uhf_34 |&gt; 
  str_split(&quot;\n&quot;) |&gt;
  tibble() |&gt; 
  rename(&quot;data&quot; = &quot;str_split(uhf_34, \&quot;\\n\&quot;)&quot;) |&gt; 
  unnest(&quot;data&quot;) |&gt; 
  filter(data != &quot;&quot;) |&gt; 
  mutate(data = str_squish(data)) |&gt; 
  filter(!row_number() %in% c(1, 2, 7, 14, 18, 21, 24, 27, 28, 31, 32, 34, 35, 39, 40, 42, 43, 44, 45, 47, 48, 52, 53, 57, 61:75)) |&gt; 
  mutate(data = str_replace(data, &quot;Kingsbridge - Riverdale&quot;, &quot;101 Kingsbridge - Riverdale&quot;)) |&gt; 
  mutate(data = str_replace(data, &quot;Northeast Bronx&quot;, &quot;102 Northeast Bronx&quot;)) |&gt; 
  filter(!row_number() %in% c(1,2)) |&gt; 
  mutate(data = str_remove_all(data, &quot;-&quot;),
         data = str_squish(data), 
         data = str_trim(data)) |&gt;
  mutate(data = str_remove(data, &quot;(\\d)+$&quot;)) |&gt;
  mutate(data = str_remove(data, &quot;(\\d)+\\s$&quot;)) |&gt;
  separate(data, into = c(&quot;uhf34&quot;, &quot;neighborhood&quot;), sep = &quot;(?&lt;=\\d\\s)&quot;) |&gt; 
  mutate(uhf34 = as.numeric(str_trim(uhf34)),
         neighborhood = str_trim(neighborhood)) |&gt; 
  mutate(uhf2 = uhf34) |&gt; 
  separate_wider_position(uhf2, widths = c(&quot;1_uhf&quot; = 3, &quot;2_uhf&quot; = 3, &quot;3_uhf&quot; = 3), too_few = &quot;align_start&quot;) |&gt; 
  pivot_longer(c(&quot;1_uhf&quot;:&quot;3_uhf&quot;), names_to = &quot;uhf_name&quot;, values_to = &quot;uhf42&quot;) |&gt; 
  select(!uhf_name) |&gt; 
  mutate(uhf34 = as.numeric(uhf34),
         uhf42 = as.numeric(uhf42))|&gt;
  mutate(borough = case_when(
    substring(uhf34, 1, 1) == &quot;1&quot; ~ &quot;Bronx&quot;,
    substring(uhf34, 1, 1) == &quot;2&quot; ~ &quot;Brooklyn&quot;,
    substring(uhf34, 1, 1) == &quot;3&quot; ~ &quot;Manhattan&quot;,
    substring(uhf34, 1, 1) == &quot;4&quot; ~ &quot;Queens&quot;,
    substring(uhf34, 1, 1) == &quot;5&quot; ~ &quot;Staten Island&quot;,
    TRUE ~ &quot;Unknown&quot;  # Handle any other values
  ))</code></pre>
<ol start="3" style="list-style-type: decimal">
<li><strong>UHF 34, UHF 42, Zip</strong> We combined UHF 42 and UHF 34
dataframes and zipcode to create a neighborhood crosswalk.</li>
</ol>
<pre class="r"><code>joined_uhf_34_42 = 
  uhf_zip_df |&gt; 
  left_join(y = uhf_34_df, by = join_by(&quot;uhf&quot; == &quot;uhf42&quot;)) |&gt; 
  rename(&quot;uhf34_neighborhood&quot; = &quot;neighborhood.y&quot;, 
         &quot;uhf42_neighborhood&quot; = &quot;neighborhood.x&quot;, 
         &quot;uhf42&quot; = &quot;uhf&quot;)</code></pre>
<hr />
</div>
<div id="bring-neighborhood-to-health-datasets" class="section level2">
<h2><span style="color: blue;">Bring Neighborhood to Health
Datasets</span></h2>
<p>Now that we have a crosswalk among all location identifiers (UHF 34,
UHF 42, and zipcode) used in our datasets, we’ll make sure they all have
UHF 34 so they can be merged together later.</p>
<div id="join-sdi-data-to-uhfzipneighborhood-data"
class="section level3">
<h3>Join SDI data to UHF/Zip/Neighborhood data</h3>
<pre class="r"><code>joined_SDI_zip_neighborhood = 
  SDI_df |&gt; 
  filter(zip %in% pull(joined_uhf_34_42, zip)) |&gt; 
  mutate(zip = as.numeric(zip)) |&gt; 
  left_join(y = joined_uhf_34_42, by = &quot;zip&quot;)</code></pre>
</div>
<div id="join-overweight-data-to-uhfzipneighborhood-data"
class="section level3">
<h3>Join Overweight data to UHF/Zip/Neighborhood data</h3>
<pre class="r"><code>joined_overweight_zip_neighborhood = 
  overweight_df |&gt; 
  left_join(y = joined_uhf_34_42, by = join_by(&quot;geo_id&quot; == &quot;uhf34&quot;)) |&gt;
  rename(percent_overweight = percent)</code></pre>
</div>
<div id="join-air-quality-data-to-uhfzipneighborhood-data"
class="section level3">
<h3>Join Air Quality data to UHF/Zip/Neighborhood data</h3>
<pre class="r"><code>#Align UHF neighborhood names
air_quality_df = 
  left_join(air_quality_df, uhf_34_df, by = c(&quot;geo_join_id&quot; = &quot;uhf34&quot;))

air_quality_df =
  air_quality_df |&gt;
select(data_value, neighborhood ) |&gt;
 distinct()</code></pre>
<hr />
</div>
</div>
<div id="bring-neighborhood-to-citi-bike-dataset"
class="section level2">
<h2><span style="color: blue;">Bring Neighborhood to Citi Bike
Dataset</span></h2>
<p>The Citi Bike data is coded by latitude/longitude. To enable merging
of Citi Bike data with the health datasets, we need to transform
coordinates to zipcode, which can later be easily converted to UHF 34
identifiers.</p>
<ul>
<li><p>To get zipcodes for each latitude/longitude pair in the Citi Bike
data, we used the <a
href="https://jessecambon.github.io/tidygeocoder/">tidygeocoder</a>
packager. The full code with details of how that was created can be
found <a href="latlong_to_zip.html">here</a>. Here, we import the
latitude/longitude to zipcode crosswalk that we generated.</p>
<ul>
<li>Note: Every Citi Bike entry has a start_latitude/longitude, and
end_latitude/longitude. Each row will accordingly have a start_zipcode
and end_zipcode.</li>
</ul></li>
</ul>
<div id="merge-citi-bike-with-zipcode" class="section level3">
<h3>Merge Citi Bike with Zipcode</h3>
<pre class="r"><code>latlong_zip = read_csv(&#39;./data/geocoding/citibike_latlong_zip.csv&#39;)

citibike_zip =
  citibike_df |&gt;
  left_join(latlong_zip, 
            by = c(&quot;start_station_latitude&quot; = &quot;latitude&quot;,
                   &quot;start_station_longitude&quot; = &quot;longitude&quot;)) |&gt;
  rename(&quot;start_zipcode&quot; = &quot;postcode&quot;) |&gt;
  left_join(latlong_zip, 
            by = c(&quot;end_station_latitude&quot; = &quot;latitude&quot;,
                   &quot;end_station_longitude&quot; = &quot;longitude&quot;)) |&gt;
  rename(&quot;end_zipcode&quot; = &quot;postcode&quot;) 

remove(citibike_df)</code></pre>
<p>There are 83953 entries missing either the start or end zipcode.</p>
<div id="missing-zipcodes" class="section level4">
<h4><em>Missing Zipcodes</em></h4>
<p>A look at the start coordinates with missing zipcodes below:</p>
<pre class="r"><code>citibike_zip |&gt;
  filter(is.na(start_zipcode)) |&gt;
  group_by(start_station_name, start_station_latitude, start_station_longitude) |&gt;
  summarize(n = n()) |&gt; 
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="32%" />
<col width="29%" />
<col width="31%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">start_station_name</th>
<th align="right">start_station_latitude</th>
<th align="right">start_station_longitude</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Broadway &amp; W 36 St</td>
<td align="right">40.75098</td>
<td align="right">-73.98765</td>
<td align="right">3305</td>
</tr>
<tr class="even">
<td align="left">Broadway &amp; W 37 St</td>
<td align="right">40.75173</td>
<td align="right">-73.98754</td>
<td align="right">2830</td>
</tr>
<tr class="odd">
<td align="left">Broadway &amp; W 38 St</td>
<td align="right">40.75300</td>
<td align="right">-73.98722</td>
<td align="right">4207</td>
</tr>
<tr class="even">
<td align="left">Broadway &amp; W 41 St</td>
<td align="right">40.75514</td>
<td align="right">-73.98658</td>
<td align="right">8446</td>
</tr>
<tr class="odd">
<td align="left">Cooper Square &amp; Astor Pl</td>
<td align="right">40.72951</td>
<td align="right">-73.99075</td>
<td align="right">7993</td>
</tr>
<tr class="even">
<td align="left">E 47 St &amp; 1 Ave</td>
<td align="right">40.75207</td>
<td align="right">-73.96784</td>
<td align="right">1622</td>
</tr>
<tr class="odd">
<td align="left">Roebling St &amp; N 4 St</td>
<td align="right">40.71469</td>
<td align="right">-73.95739</td>
<td align="right">1758</td>
</tr>
<tr class="even">
<td align="left">South St &amp; Gouverneur Ln</td>
<td align="right">40.70355</td>
<td align="right">-74.00670</td>
<td align="right">6047</td>
</tr>
<tr class="odd">
<td align="left">W 52 St &amp; 6 Ave</td>
<td align="right">40.76133</td>
<td align="right">-73.97982</td>
<td align="right">4100</td>
</tr>
<tr class="even">
<td align="left">William St &amp; Pine St</td>
<td align="right">40.70718</td>
<td align="right">-74.00887</td>
<td align="right">2582</td>
</tr>
</tbody>
</table>
<p>A look at the end coordinates with missing zipcodes below:</p>
<pre class="r"><code>citibike_zip |&gt;
  filter(is.na(end_zipcode)) |&gt;
  group_by(end_station_name, end_station_latitude, end_station_longitude) |&gt;
  summarize(n = n()) |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="34%" />
<col width="28%" />
<col width="30%" />
<col width="6%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">end_station_name</th>
<th align="right">end_station_latitude</th>
<th align="right">end_station_longitude</th>
<th align="right">n</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">Broadway &amp; W 36 St</td>
<td align="right">40.75098</td>
<td align="right">-73.98765</td>
<td align="right">3045</td>
</tr>
<tr class="even">
<td align="left">Broadway &amp; W 37 St</td>
<td align="right">40.75173</td>
<td align="right">-73.98754</td>
<td align="right">2705</td>
</tr>
<tr class="odd">
<td align="left">Broadway &amp; W 38 St</td>
<td align="right">40.75300</td>
<td align="right">-73.98722</td>
<td align="right">4341</td>
</tr>
<tr class="even">
<td align="left">Broadway &amp; W 41 St</td>
<td align="right">40.75514</td>
<td align="right">-73.98658</td>
<td align="right">8530</td>
</tr>
<tr class="odd">
<td align="left">Cooper Square &amp; Astor Pl</td>
<td align="right">40.72951</td>
<td align="right">-73.99075</td>
<td align="right">7581</td>
</tr>
<tr class="even">
<td align="left">E 47 St &amp; 1 Ave</td>
<td align="right">40.75207</td>
<td align="right">-73.96784</td>
<td align="right">1672</td>
</tr>
<tr class="odd">
<td align="left">Roebling St &amp; N 4 St</td>
<td align="right">40.71469</td>
<td align="right">-73.95739</td>
<td align="right">1805</td>
</tr>
<tr class="even">
<td align="left">South St &amp; Gouverneur Ln</td>
<td align="right">40.70355</td>
<td align="right">-74.00670</td>
<td align="right">5718</td>
</tr>
<tr class="odd">
<td align="left">W 52 St &amp; 6 Ave</td>
<td align="right">40.76133</td>
<td align="right">-73.97982</td>
<td align="right">4437</td>
</tr>
<tr class="even">
<td align="left">William St &amp; Pine St</td>
<td align="right">40.70718</td>
<td align="right">-74.00887</td>
<td align="right">2626</td>
</tr>
</tbody>
</table>
</div>
<div id="manual-zipcode-completion" class="section level4">
<h4><em>Manual Zipcode Completion</em></h4>
<p>For the above missing zipcodes, we manually coded based on latitude,
longitude, and <code>station_name</code> to identify what the correct
zipcode. Upon manually exploration, these looked like some data quality
issues with the coordinates, but based on the staton name we were able
to identify the correct zipcode. We stored this work in a .csv on our
github <a
href="https://github.com/courtneyjdiamond/pedalstopatterns.github.io/blob/main/data/geocoding/manual_zipcodes.csv">here</a>.
The code below implements filling in those missing zipcode values.</p>
<pre class="r"><code>citibike_zip = citibike_zip |&gt;
  mutate(start_zipcode = case_when(start_station_name == &quot;Broadway &amp; W 32 St&quot; ~ 10001,
                               start_station_name == &quot;Cooper Square &amp; Astor Pl&quot; ~ 10003,
                               start_station_name == &quot;William St &amp; Pine St&quot; ~ 10005,
                               start_station_name %in% c(&quot;Broadway &amp; W 36 St&quot;,&quot;Broadway &amp; W 37 St&quot;,&quot;Broadway &amp; W 38 St&quot;,&quot;Broadway &amp; W 41 St&quot;) ~ 10018,
                               start_station_name == &quot;W 52 St &amp; 6 Ave&quot; ~ 100019,
                               start_station_name %in% c(&quot;Broadway &amp; W 41 St&quot;,&quot;W 43 St &amp; 6 Ave&quot;) ~ 10036,
                               start_station_name == &quot;South St &amp; Gouverneur Ln&quot; ~ 10043,
                               start_station_name == &quot;E 47 St &amp; 1 Ave&quot; ~ 10075,
                               start_station_name == &quot;Roebling St &amp; N 4 St&quot; ~ 11211,
                               TRUE ~ start_zipcode)) |&gt;
  mutate(end_zipcode = case_when(end_station_name == &quot;Broadway &amp; W 32 St&quot; ~ 10001,
                               end_station_name == &quot;Cooper Square &amp; Astor Pl&quot; ~ 10003,
                               end_station_name == &quot;William St &amp; Pine St&quot; ~ 10005,
                               end_station_name %in% c(&quot;Broadway &amp; W 36 St&quot;,&quot;Broadway &amp; W 37 St&quot;,&quot;Broadway &amp; W 38 St&quot;,&quot;Broadway &amp; W 41 St&quot;) ~ 10018,
                               end_station_name == &quot;W 52 St &amp; 6 Ave&quot; ~ 100019,
                               end_station_name %in% c(&quot;Broadway &amp; W 41 St&quot;,&quot;W 43 St &amp; 6 Ave&quot;) ~ 10036,
                               end_station_name == &quot;South St &amp; Gouverneur Ln&quot; ~ 10043,
                               end_station_name == &quot;E 47 St &amp; 1 Ave&quot; ~ 10075,
                               end_station_name == &quot;Roebling St &amp; N 4 St&quot; ~ 11211,
                               TRUE ~ end_zipcode))</code></pre>
</div>
</div>
<div id="merge-citi-bike-with-uhf-34-neighborhood"
class="section level3">
<h3>Merge Citi Bike with UHF 34 Neighborhood</h3>
<p>Now that we have the zipcodes for Citi Bike data, we can use the
zipcode and UHF 34 crosswalk generated above to get neighborhood names
onto the Citi Bike data.</p>
<pre class="r"><code>citibike_zip_neighborhoods =
  citibike_zip |&gt;
  left_join(y = (joined_uhf_34_42 |&gt; select(zip, uhf42_neighborhood, uhf34_neighborhood)),
            by = join_by(&quot;start_zipcode&quot; == &quot;zip&quot;)) |&gt; 
  rename(&quot;start_uhf34_neighborhood&quot; = &quot;uhf34_neighborhood&quot;,
         &quot;start_uhf42_neighborhood&quot; = &quot;uhf42_neighborhood&quot;) |&gt; 
  left_join(y = (joined_uhf_34_42 |&gt; select(zip, uhf42_neighborhood, uhf34_neighborhood)),
            by = join_by(&quot;end_zipcode&quot; == &quot;zip&quot;)) |&gt; 
  rename(&quot;end_uhf34_neighborhood&quot; = &quot;uhf34_neighborhood&quot;,
         &quot;end_uhf42_neighborhood&quot; = &quot;uhf42_neighborhood&quot;)

remove(citibike_zip)

head(citibike_zip_neighborhoods) |&gt; 
  knitr::kable()</code></pre>
<table style="width:100%;">
<colgroup>
<col width="3%" />
<col width="3%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="6%" />
<col width="5%" />
<col width="5%" />
<col width="3%" />
<col width="6%" />
<col width="4%" />
<col width="4%" />
<col width="1%" />
<col width="2%" />
<col width="2%" />
<col width="1%" />
<col width="1%" />
<col width="0%" />
<col width="3%" />
<col width="2%" />
<col width="6%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">trip_duration_sec</th>
<th align="right">trip_duration_min</th>
<th align="left">start_time</th>
<th align="left">stop_time</th>
<th align="right">start_station_id</th>
<th align="left">start_station_name</th>
<th align="right">start_station_latitude</th>
<th align="right">start_station_longitude</th>
<th align="right">end_station_id</th>
<th align="left">end_station_name</th>
<th align="right">end_station_latitude</th>
<th align="right">end_station_longitude</th>
<th align="right">bikeid</th>
<th align="left">user_type</th>
<th align="right">birth_year</th>
<th align="left">gender</th>
<th align="left">month</th>
<th align="right">age</th>
<th align="right">start_zipcode</th>
<th align="right">end_zipcode</th>
<th align="left">start_uhf42_neighborhood</th>
<th align="left">start_uhf34_neighborhood</th>
<th align="left">end_uhf42_neighborhood</th>
<th align="left">end_uhf34_neighborhood</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">327</td>
<td align="right">5.450000</td>
<td align="left">2019-09-01 00:00:01</td>
<td align="left">2019-09-01 00:05:29</td>
<td align="right">3733</td>
<td align="left">Avenue C &amp; E 18 St</td>
<td align="right">40.73056</td>
<td align="right">-73.97398</td>
<td align="right">504</td>
<td align="left">1 Ave &amp; E 16 St</td>
<td align="right">40.73222</td>
<td align="right">-73.98166</td>
<td align="right">39213</td>
<td align="left">Subscriber</td>
<td align="right">1968</td>
<td align="left">Male</td>
<td align="left">9</td>
<td align="right">51</td>
<td align="right">10009</td>
<td align="right">10009</td>
<td align="left">Union Square Lower East Side</td>
<td align="left">Union Square, Lower Manhattan</td>
<td align="left">Union Square Lower East Side</td>
<td align="left">Union Square, Lower Manhattan</td>
</tr>
<tr class="even">
<td align="right">1145</td>
<td align="right">19.083333</td>
<td align="left">2019-09-01 00:00:04</td>
<td align="left">2019-09-01 00:19:09</td>
<td align="right">3329</td>
<td align="left">Degraw St &amp; Smith St</td>
<td align="right">40.68292</td>
<td align="right">-73.99318</td>
<td align="right">270</td>
<td align="left">Adelphi St &amp; Myrtle Ave</td>
<td align="right">40.69308</td>
<td align="right">-73.97179</td>
<td align="right">21257</td>
<td align="left">Customer</td>
<td align="right">1969</td>
<td align="left">Unknown</td>
<td align="left">9</td>
<td align="right">50</td>
<td align="right">11217</td>
<td align="right">11238</td>
<td align="left">Downtown Heights Park Slope</td>
<td align="left">Downtown Heights Slope</td>
<td align="left">Bedford Stuyvesant Crown Heights</td>
<td align="left">Bedford Stuyvesant Crown Heights</td>
</tr>
<tr class="odd">
<td align="right">1293</td>
<td align="right">21.550000</td>
<td align="left">2019-09-01 00:00:07</td>
<td align="left">2019-09-01 00:21:40</td>
<td align="right">3168</td>
<td align="left">Central Park West &amp; W 85 St</td>
<td align="right">40.78473</td>
<td align="right">-73.96962</td>
<td align="right">423</td>
<td align="left">W 54 St &amp; 9 Ave</td>
<td align="right">40.76585</td>
<td align="right">-73.98691</td>
<td align="right">15242</td>
<td align="left">Customer</td>
<td align="right">1969</td>
<td align="left">Unknown</td>
<td align="left">9</td>
<td align="right">50</td>
<td align="right">10024</td>
<td align="right">10019</td>
<td align="left">Upper West Side</td>
<td align="left">Upper West Side</td>
<td align="left">Chelsea Clinton</td>
<td align="left">Chelsea Village</td>
</tr>
<tr class="even">
<td align="right">1753</td>
<td align="right">29.216667</td>
<td align="left">2019-09-01 00:00:08</td>
<td align="left">2019-09-01 00:29:21</td>
<td align="right">3299</td>
<td align="left">E 98 St &amp; Park Ave</td>
<td align="right">40.78813</td>
<td align="right">-73.95206</td>
<td align="right">3160</td>
<td align="left">Central Park West &amp; W 76 St</td>
<td align="right">40.77897</td>
<td align="right">-73.97375</td>
<td align="right">38760</td>
<td align="left">Subscriber</td>
<td align="right">1990</td>
<td align="left">Male</td>
<td align="left">9</td>
<td align="right">29</td>
<td align="right">10129</td>
<td align="right">10024</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">Upper West Side</td>
<td align="left">Upper West Side</td>
</tr>
<tr class="odd">
<td align="right">613</td>
<td align="right">10.216667</td>
<td align="left">2019-09-01 00:00:12</td>
<td align="left">2019-09-01 00:10:26</td>
<td align="right">486</td>
<td align="left">Broadway &amp; W 29 St</td>
<td align="right">40.74620</td>
<td align="right">-73.98856</td>
<td align="right">478</td>
<td align="left">11 Ave &amp; W 41 St</td>
<td align="right">40.76030</td>
<td align="right">-73.99884</td>
<td align="right">32094</td>
<td align="left">Subscriber</td>
<td align="right">1992</td>
<td align="left">Male</td>
<td align="left">9</td>
<td align="right">27</td>
<td align="right">10019</td>
<td align="right">10018</td>
<td align="left">Chelsea Clinton</td>
<td align="left">Chelsea Village</td>
<td align="left">Chelsea Clinton</td>
<td align="left">Chelsea Village</td>
</tr>
<tr class="even">
<td align="right">482</td>
<td align="right">8.033333</td>
<td align="left">2019-09-01 00:00:16</td>
<td align="left">2019-09-01 00:08:19</td>
<td align="right">3775</td>
<td align="left">Suydam St &amp; Knickerbocker Ave</td>
<td align="right">40.70201</td>
<td align="right">-73.92377</td>
<td align="right">3771</td>
<td align="left">McKibbin St &amp; Bogart St</td>
<td align="right">40.70624</td>
<td align="right">-73.93387</td>
<td align="right">28271</td>
<td align="left">Customer</td>
<td align="right">1969</td>
<td align="left">Unknown</td>
<td align="left">9</td>
<td align="right">50</td>
<td align="right">11237</td>
<td align="right">11206</td>
<td align="left">Williamsburg Bushwick</td>
<td align="left">Williamsburg Bushwick</td>
<td align="left">Williamsburg Bushwick</td>
<td align="left">Williamsburg Bushwick</td>
</tr>
</tbody>
</table>
<div id="missing-uhf34" class="section level4">
<h4><em>Missing UHF34</em></h4>
<p>There were some Citi Bike zipcodes with missing UHF 34, which we
explore below:</p>
<pre class="r"><code>missing_startuhf = citibike_zip_neighborhoods |&gt;
  filter(is.na(start_uhf34_neighborhood)) |&gt;
  group_by(start_zipcode) |&gt;
  summarize(n = n()) |&gt;
  rename(zipcode = start_zipcode)
  
missing_enduhf = citibike_zip_neighborhoods |&gt;
  filter(is.na(end_uhf34_neighborhood)) |&gt;
  group_by(end_zipcode) |&gt;
  summarize(n = n()) |&gt;
  rename(zipcode = end_zipcode)

#write_csv(rbind(missing_startuhf, missing_enduhf) ,&#39;../data/geocoding/missing_uhf34.csv&#39;)

citibike_zip_neighborhoods = citibike_zip_neighborhoods |&gt;
  filter(!is.na(end_uhf34_neighborhood) &amp; !is.na(start_uhf34_neighborhood))</code></pre>
<p>There are 241988 entries whose start zipcode do not have an
associated UHF 34, and 244314 entries whose end zipcode do not have an
associated UHF 34. Manual validation showed these zipcodes are business
zipcodes, where a zipcode refers to a small domain of a business. While
these could be pinpointed roughly to a UHF 34 neighborhood manually, it
is cleaner to simply omit them, as we still retain a substantial dataset
size. The resulting dataset has 1628960 entries.</p>
<hr />
</div>
</div>
</div>
<div id="final-dataset-merge-citi-bike-sdi-overweight-and-aq"
class="section level2">
<h2><span style="color: blue;">Final Dataset: Merge Citi Bike, SDI,
Overweight, and AQ</span></h2>
<p>Next we needed to create one large dataframe that merged the Citi
Bike data with and each health dataset by UHF 34 neighborhood.</p>
<div id="merge-sdi-and-overweight-data" class="section level3">
<h3>Merge SDI and Overweight data</h3>
<p>SDI and overweight are joined together first by UHF 42.</p>
<ul>
<li>Note: There are rows in the overweight data without zipcode that
refer instead to borough and city-wide overweight percentages. These are
excluded from joining on SDI/citibike data, which function by zipcode
that is more granular than borough. These are what is excluded by
filtering out null values.</li>
</ul>
<pre class="r"><code>sdi_overweight = 
  merge(joined_overweight_zip_neighborhood, joined_SDI_zip_neighborhood,
                   by.x = c(&quot;zip&quot;, &quot;uhf42&quot;, &quot;uhf42_neighborhood&quot;),
                   by.y = c(&quot;zip&quot;, &quot;uhf42&quot;, &quot;uhf42_neighborhood&quot;),
                   all.x = TRUE)  |&gt;
  select(&quot;zip&quot;,&quot;uhf34&quot;,&quot;uhf34_neighborhood.x&quot;,&quot;uhf42&quot;,&quot;uhf42_neighborhood&quot;,
         &quot;sdi_score&quot;,&quot;percent_overweight&quot;, &quot;borough.x&quot;) |&gt;
  rename(uhf34_neighborhood = uhf34_neighborhood.x,
         borough = borough.x) |&gt;
  filter(!is.na(zip)) 

remove(joined_overweight_zip_neighborhood)
remove(joined_SDI_zip_neighborhood)
remove(SDI_df)
remove(overweight_df)</code></pre>
</div>
<div id="merge-sdi-and-overweight-data-onto-citi-bike"
class="section level3">
<h3>Merge SDI and Overweight data onto Citi Bike</h3>
<pre class="r"><code>citibike_df =
  citibike_zip_neighborhoods |&gt;
  left_join(y = sdi_overweight,
            by = join_by(&quot;start_zipcode&quot; == &quot;zip&quot;)) |&gt;
  rename(&quot;start_sdi_score&quot; = &quot;sdi_score&quot;,
         &quot;start_percent_overweight&quot; = &quot;percent_overweight&quot;,
         &quot;start_borough&quot; = &quot;borough&quot;) 

remove(citibike_zip_neighborhoods)

citibike_df = citibike_df |&gt;
  left_join(y = sdi_overweight,
            by = join_by(&quot;end_zipcode&quot; == &quot;zip&quot;)) |&gt;
  rename(&quot;end_sdi_score&quot; = &quot;sdi_score&quot;,
         &quot;end_percent_overweight&quot; = &quot;percent_overweight&quot;,
         &quot;end_borough&quot; = &quot;borough&quot;) </code></pre>
</div>
<div id="merge-aq-data-onto-citi-bike" class="section level3">
<h3>Merge AQ data onto Citi Bike</h3>
<pre class="r"><code>#Join to final dataframe
citibike_df =
  citibike_df |&gt;
  left_join(y = air_quality_df,
            by = join_by(&quot;start_uhf34_neighborhood&quot; == &quot;neighborhood&quot;)) |&gt;
  rename(&quot;start_aq&quot; = &quot;data_value&quot;)

citibike_df = citibike_df |&gt;
  left_join(y = air_quality_df,
            by = join_by(&quot;end_uhf34_neighborhood&quot; == &quot;neighborhood&quot;)) |&gt;
  rename(&quot;end_aq&quot; = &quot;data_value&quot;)</code></pre>
</div>
<div id="final-tidy-of-citi-bike-data" class="section level3">
<h3>Final Tidy of Citi Bike Data</h3>
<p>A view at the final dataset, as well as overall summary of variables
included and any missing values:</p>
<pre class="r"><code>citibike_df = citibike_df |&gt;
  select(bikeid, user_type, gender, age,
         start_time, stop_time, 
         start_station_latitude, start_station_longitude, 
         end_station_latitude, end_station_longitude,
         start_station_id, start_station_name,
         start_zipcode, start_uhf34_neighborhood,
         end_station_id, end_station_name,
         end_zipcode, end_uhf34_neighborhood,
         start_sdi_score, start_percent_overweight, start_aq,
         end_sdi_score, end_percent_overweight, end_aq, end_borough, start_borough)

head(citibike_df) |&gt;
  knitr::kable()</code></pre>
<table>
<colgroup>
<col width="1%" />
<col width="2%" />
<col width="1%" />
<col width="0%" />
<col width="4%" />
<col width="4%" />
<col width="5%" />
<col width="5%" />
<col width="4%" />
<col width="4%" />
<col width="3%" />
<col width="6%" />
<col width="3%" />
<col width="6%" />
<col width="3%" />
<col width="5%" />
<col width="2%" />
<col width="7%" />
<col width="3%" />
<col width="5%" />
<col width="1%" />
<col width="3%" />
<col width="5%" />
<col width="1%" />
<col width="2%" />
<col width="3%" />
</colgroup>
<thead>
<tr class="header">
<th align="right">bikeid</th>
<th align="left">user_type</th>
<th align="left">gender</th>
<th align="right">age</th>
<th align="left">start_time</th>
<th align="left">stop_time</th>
<th align="right">start_station_latitude</th>
<th align="right">start_station_longitude</th>
<th align="right">end_station_latitude</th>
<th align="right">end_station_longitude</th>
<th align="right">start_station_id</th>
<th align="left">start_station_name</th>
<th align="right">start_zipcode</th>
<th align="left">start_uhf34_neighborhood</th>
<th align="right">end_station_id</th>
<th align="left">end_station_name</th>
<th align="right">end_zipcode</th>
<th align="left">end_uhf34_neighborhood</th>
<th align="right">start_sdi_score</th>
<th align="right">start_percent_overweight</th>
<th align="right">start_aq</th>
<th align="right">end_sdi_score</th>
<th align="right">end_percent_overweight</th>
<th align="right">end_aq</th>
<th align="left">end_borough</th>
<th align="left">start_borough</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="right">39213</td>
<td align="left">Subscriber</td>
<td align="left">Male</td>
<td align="right">51</td>
<td align="left">2019-09-01 00:00:01</td>
<td align="left">2019-09-01 00:05:29</td>
<td align="right">40.73056</td>
<td align="right">-73.97398</td>
<td align="right">40.73222</td>
<td align="right">-73.98166</td>
<td align="right">3733</td>
<td align="left">Avenue C &amp; E 18 St</td>
<td align="right">10009</td>
<td align="left">Union Square, Lower Manhattan</td>
<td align="right">504</td>
<td align="left">1 Ave &amp; E 16 St</td>
<td align="right">10009</td>
<td align="left">Union Square, Lower Manhattan</td>
<td align="right">88</td>
<td align="right">40.5</td>
<td align="right">8.67</td>
<td align="right">88</td>
<td align="right">40.5</td>
<td align="right">8.67</td>
<td align="left">Manhattan</td>
<td align="left">Manhattan</td>
</tr>
<tr class="even">
<td align="right">21257</td>
<td align="left">Customer</td>
<td align="left">Unknown</td>
<td align="right">50</td>
<td align="left">2019-09-01 00:00:04</td>
<td align="left">2019-09-01 00:19:09</td>
<td align="right">40.68292</td>
<td align="right">-73.99318</td>
<td align="right">40.69308</td>
<td align="right">-73.97179</td>
<td align="right">3329</td>
<td align="left">Degraw St &amp; Smith St</td>
<td align="right">11217</td>
<td align="left">Downtown Heights Slope</td>
<td align="right">270</td>
<td align="left">Adelphi St &amp; Myrtle Ave</td>
<td align="right">11238</td>
<td align="left">Bedford Stuyvesant Crown Heights</td>
<td align="right">74</td>
<td align="right">50.8</td>
<td align="right">7.44</td>
<td align="right">70</td>
<td align="right">62.9</td>
<td align="right">6.61</td>
<td align="left">Brooklyn</td>
<td align="left">Brooklyn</td>
</tr>
<tr class="odd">
<td align="right">15242</td>
<td align="left">Customer</td>
<td align="left">Unknown</td>
<td align="right">50</td>
<td align="left">2019-09-01 00:00:07</td>
<td align="left">2019-09-01 00:21:40</td>
<td align="right">40.78473</td>
<td align="right">-73.96962</td>
<td align="right">40.76585</td>
<td align="right">-73.98691</td>
<td align="right">3168</td>
<td align="left">Central Park West &amp; W 85 St</td>
<td align="right">10024</td>
<td align="left">Upper West Side</td>
<td align="right">423</td>
<td align="left">W 54 St &amp; 9 Ave</td>
<td align="right">10019</td>
<td align="left">Chelsea Village</td>
<td align="right">41</td>
<td align="right">43.4</td>
<td align="right">7.38</td>
<td align="right">63</td>
<td align="right">38.1</td>
<td align="right">10.02</td>
<td align="left">Manhattan</td>
<td align="left">Manhattan</td>
</tr>
<tr class="even">
<td align="right">32094</td>
<td align="left">Subscriber</td>
<td align="left">Male</td>
<td align="right">27</td>
<td align="left">2019-09-01 00:00:12</td>
<td align="left">2019-09-01 00:10:26</td>
<td align="right">40.74620</td>
<td align="right">-73.98856</td>
<td align="right">40.76030</td>
<td align="right">-73.99884</td>
<td align="right">486</td>
<td align="left">Broadway &amp; W 29 St</td>
<td align="right">10019</td>
<td align="left">Chelsea Village</td>
<td align="right">478</td>
<td align="left">11 Ave &amp; W 41 St</td>
<td align="right">10018</td>
<td align="left">Chelsea Village</td>
<td align="right">63</td>
<td align="right">38.1</td>
<td align="right">10.02</td>
<td align="right">65</td>
<td align="right">38.1</td>
<td align="right">10.02</td>
<td align="left">Manhattan</td>
<td align="left">Manhattan</td>
</tr>
<tr class="odd">
<td align="right">28271</td>
<td align="left">Customer</td>
<td align="left">Unknown</td>
<td align="right">50</td>
<td align="left">2019-09-01 00:00:16</td>
<td align="left">2019-09-01 00:08:19</td>
<td align="right">40.70201</td>
<td align="right">-73.92377</td>
<td align="right">40.70624</td>
<td align="right">-73.93387</td>
<td align="right">3775</td>
<td align="left">Suydam St &amp; Knickerbocker Ave</td>
<td align="right">11237</td>
<td align="left">Williamsburg Bushwick</td>
<td align="right">3771</td>
<td align="left">McKibbin St &amp; Bogart St</td>
<td align="right">11206</td>
<td align="left">Williamsburg Bushwick</td>
<td align="right">98</td>
<td align="right">61.8</td>
<td align="right">7.50</td>
<td align="right">100</td>
<td align="right">61.8</td>
<td align="right">7.50</td>
<td align="left">Brooklyn</td>
<td align="left">Brooklyn</td>
</tr>
<tr class="even">
<td align="right">39424</td>
<td align="left">Customer</td>
<td align="left">Unknown</td>
<td align="right">50</td>
<td align="left">2019-09-01 00:00:17</td>
<td align="left">2019-09-01 00:08:27</td>
<td align="right">40.70201</td>
<td align="right">-73.92377</td>
<td align="right">40.70624</td>
<td align="right">-73.93387</td>
<td align="right">3775</td>
<td align="left">Suydam St &amp; Knickerbocker Ave</td>
<td align="right">11237</td>
<td align="left">Williamsburg Bushwick</td>
<td align="right">3771</td>
<td align="left">McKibbin St &amp; Bogart St</td>
<td align="right">11206</td>
<td align="left">Williamsburg Bushwick</td>
<td align="right">98</td>
<td align="right">61.8</td>
<td align="right">7.50</td>
<td align="right">100</td>
<td align="right">61.8</td>
<td align="right">7.50</td>
<td align="left">Brooklyn</td>
<td align="left">Brooklyn</td>
</tr>
</tbody>
</table>
<pre class="r"><code>skimr::skim(citibike_df)</code></pre>
<table>
<caption>Data summary</caption>
<tbody>
<tr class="odd">
<td align="left">Name</td>
<td align="left">citibike_df</td>
</tr>
<tr class="even">
<td align="left">Number of rows</td>
<td align="left">1628960</td>
</tr>
<tr class="odd">
<td align="left">Number of columns</td>
<td align="left">26</td>
</tr>
<tr class="even">
<td align="left">_______________________</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">Column type frequency:</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">character</td>
<td align="left">8</td>
</tr>
<tr class="odd">
<td align="left">numeric</td>
<td align="left">16</td>
</tr>
<tr class="even">
<td align="left">POSIXct</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">________________________</td>
<td align="left"></td>
</tr>
<tr class="even">
<td align="left">Group variables</td>
<td align="left">None</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: character</strong></p>
<table style="width:100%;">
<colgroup>
<col width="30%" />
<col width="12%" />
<col width="16%" />
<col width="4%" />
<col width="4%" />
<col width="7%" />
<col width="10%" />
<col width="13%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">min</th>
<th align="right">max</th>
<th align="right">empty</th>
<th align="right">n_unique</th>
<th align="right">whitespace</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">user_type</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8</td>
<td align="right">10</td>
<td align="right">0</td>
<td align="right">2</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">gender</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">4</td>
<td align="right">7</td>
<td align="right">0</td>
<td align="right">3</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">start_station_name</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">45</td>
<td align="right">0</td>
<td align="right">732</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">start_uhf34_neighborhood</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">34</td>
<td align="right">0</td>
<td align="right">20</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">end_station_name</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">9</td>
<td align="right">45</td>
<td align="right">0</td>
<td align="right">734</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">end_uhf34_neighborhood</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10</td>
<td align="right">34</td>
<td align="right">0</td>
<td align="right">20</td>
<td align="right">0</td>
</tr>
<tr class="odd">
<td align="left">end_borough</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
<tr class="even">
<td align="left">start_borough</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">5</td>
<td align="right">9</td>
<td align="right">0</td>
<td align="right">4</td>
<td align="right">0</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: numeric</strong></p>
<table style="width:100%;">
<colgroup>
<col width="21%" />
<col width="8%" />
<col width="11%" />
<col width="7%" />
<col width="6%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="7%" />
<col width="5%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="right">mean</th>
<th align="right">sd</th>
<th align="right">p0</th>
<th align="right">p25</th>
<th align="right">p50</th>
<th align="right">p75</th>
<th align="right">p100</th>
<th align="left">hist</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">bikeid</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">30704.72</td>
<td align="right">8091.71</td>
<td align="right">14529.00</td>
<td align="right">25653.00</td>
<td align="right">31820.00</td>
<td align="right">38666.00</td>
<td align="right">42046.00</td>
<td align="left">▅▂▆▆▇</td>
</tr>
<tr class="even">
<td align="left">age</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">37.99</td>
<td align="right">12.12</td>
<td align="right">16.00</td>
<td align="right">28.00</td>
<td align="right">35.00</td>
<td align="right">49.00</td>
<td align="right">145.00</td>
<td align="left">▇▅▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">start_station_latitude</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">40.74</td>
<td align="right">0.03</td>
<td align="right">40.66</td>
<td align="right">40.72</td>
<td align="right">40.74</td>
<td align="right">40.76</td>
<td align="right">40.81</td>
<td align="left">▂▃▇▅▂</td>
</tr>
<tr class="even">
<td align="left">start_station_longitude</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">-73.98</td>
<td align="right">0.02</td>
<td align="right">-74.03</td>
<td align="right">-74.00</td>
<td align="right">-73.99</td>
<td align="right">-73.97</td>
<td align="right">-73.91</td>
<td align="left">▂▇▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">end_station_latitude</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">40.74</td>
<td align="right">0.03</td>
<td align="right">40.66</td>
<td align="right">40.72</td>
<td align="right">40.74</td>
<td align="right">40.75</td>
<td align="right">40.81</td>
<td align="left">▂▃▇▅▁</td>
</tr>
<tr class="even">
<td align="left">end_station_longitude</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">-73.98</td>
<td align="right">0.02</td>
<td align="right">-74.03</td>
<td align="right">-74.00</td>
<td align="right">-73.99</td>
<td align="right">-73.97</td>
<td align="right">-73.91</td>
<td align="left">▂▇▃▂▁</td>
</tr>
<tr class="odd">
<td align="left">start_station_id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1639.02</td>
<td align="right">1492.10</td>
<td align="right">72.00</td>
<td align="right">369.00</td>
<td align="right">501.00</td>
<td align="right">3320.00</td>
<td align="right">3858.00</td>
<td align="left">▇▁▁▁▅</td>
</tr>
<tr class="even">
<td align="left">start_zipcode</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10245.96</td>
<td align="right">466.13</td>
<td align="right">10001.00</td>
<td align="right">10010.00</td>
<td align="right">10017.00</td>
<td align="right">10036.00</td>
<td align="right">11385.00</td>
<td align="left">▇▁▁▁▂</td>
</tr>
<tr class="odd">
<td align="left">end_station_id</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">1622.52</td>
<td align="right">1490.86</td>
<td align="right">72.00</td>
<td align="right">366.00</td>
<td align="right">499.00</td>
<td align="right">3319.00</td>
<td align="right">3858.00</td>
<td align="left">▇▁▁▁▅</td>
</tr>
<tr class="even">
<td align="left">end_zipcode</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">10247.44</td>
<td align="right">467.52</td>
<td align="right">10001.00</td>
<td align="right">10010.00</td>
<td align="right">10017.00</td>
<td align="right">10036.00</td>
<td align="right">11385.00</td>
<td align="left">▇▁▁▁▂</td>
</tr>
<tr class="odd">
<td align="left">start_sdi_score</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">64.91</td>
<td align="right">21.57</td>
<td align="right">26.00</td>
<td align="right">49.00</td>
<td align="right">63.00</td>
<td align="right">88.00</td>
<td align="right">100.00</td>
<td align="left">▃▇▇▂▇</td>
</tr>
<tr class="even">
<td align="left">start_percent_overweight</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">43.78</td>
<td align="right">9.67</td>
<td align="right">36.50</td>
<td align="right">38.10</td>
<td align="right">40.50</td>
<td align="right">43.40</td>
<td align="right">71.20</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="odd">
<td align="left">start_aq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.74</td>
<td align="right">1.10</td>
<td align="right">6.04</td>
<td align="right">7.50</td>
<td align="right">8.67</td>
<td align="right">10.02</td>
<td align="right">10.02</td>
<td align="left">▁▅▁▇▇</td>
</tr>
<tr class="even">
<td align="left">end_sdi_score</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">65.00</td>
<td align="right">21.52</td>
<td align="right">26.00</td>
<td align="right">49.00</td>
<td align="right">63.00</td>
<td align="right">88.00</td>
<td align="right">100.00</td>
<td align="left">▃▇▇▂▇</td>
</tr>
<tr class="odd">
<td align="left">end_percent_overweight</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">43.74</td>
<td align="right">9.64</td>
<td align="right">36.50</td>
<td align="right">38.10</td>
<td align="right">40.50</td>
<td align="right">43.40</td>
<td align="right">71.20</td>
<td align="left">▇▁▁▁▁</td>
</tr>
<tr class="even">
<td align="left">end_aq</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="right">8.75</td>
<td align="right">1.10</td>
<td align="right">6.04</td>
<td align="right">7.50</td>
<td align="right">8.67</td>
<td align="right">10.02</td>
<td align="right">10.02</td>
<td align="left">▁▅▁▇▇</td>
</tr>
</tbody>
</table>
<p><strong>Variable type: POSIXct</strong></p>
<table>
<colgroup>
<col width="13%" />
<col width="9%" />
<col width="13%" />
<col width="18%" />
<col width="18%" />
<col width="18%" />
<col width="8%" />
</colgroup>
<thead>
<tr class="header">
<th align="left">skim_variable</th>
<th align="right">n_missing</th>
<th align="right">complete_rate</th>
<th align="left">min</th>
<th align="left">max</th>
<th align="left">median</th>
<th align="right">n_unique</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td align="left">start_time</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2019-09-01 00:00:01</td>
<td align="left">2019-09-30 23:59:55</td>
<td align="left">2019-09-17 08:08:46</td>
<td align="right">1628135</td>
</tr>
<tr class="even">
<td align="left">stop_time</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">2019-09-01 00:05:29</td>
<td align="left">2019-10-01 15:50:20</td>
<td align="left">2019-09-17 08:23:05</td>
<td align="right">1628096</td>
</tr>
</tbody>
</table>
<pre class="r"><code>write_csv(citibike_df, file = &#39;./citibike_clean/citibike_clean.csv&#39;)</code></pre>
<p>The tidied Citi Bike dataframe includes 1628960 trips and 26
variables named bikeid, user_type, gender, age, start_time, stop_time,
start_station_latitude, start_station_longitude, end_station_latitude,
end_station_longitude, start_station_id, start_station_name,
start_zipcode, start_uhf34_neighborhood, end_station_id,
end_station_name, end_zipcode, end_uhf34_neighborhood, start_sdi_score,
start_percent_overweight, start_aq, end_sdi_score,
end_percent_overweight, end_aq, end_borough, start_borough.</p>
<p> </p>
<hr />
</div>
</div>
<div id="stations-analysis" class="section level2">
<h2><span style="color: blue;">Stations Analysis</span></h2>
<p>For some extra analysis work, we want to understand the full
availability of stations (not just the ones used in September). So we
also have to join zipcode and UHF 34 neighborhood to our full station
data.</p>
<pre class="r"><code>stations = stations |&gt;
  left_join(latlong_zip, 
            by = c(&quot;latitude&quot; ,&quot;longitude&quot;)) |&gt;
  rename(&quot;zipcode&quot; = &quot;postcode&quot;) |&gt;
  mutate(zipcode = case_when(station_name == &quot;Broadway &amp; W 32 St&quot; ~ 10001,
                             station_name == &quot;Cooper Square &amp; Astor Pl&quot; ~ 10003,
                             station_name == &quot;William St &amp; Pine St&quot; ~ 10005,
                             station_name %in% c(&quot;Broadway &amp; W 36 St&quot;,
                                                 &quot;Broadway &amp; W 37 St&quot;,
                                                 &quot;Broadway &amp; W 38 St&quot;,
                                                 &quot;Broadway &amp; W 41 St&quot;) ~ 10018,
                             station_name == &quot;W 52 St &amp; 6 Ave&quot; ~ 100019,
                             station_name %in% c(&quot;Broadway &amp; W 41 St&quot;,
                                                 &quot;W 43 St &amp; 6 Ave&quot;) ~ 10036,
                             station_name == &quot;South St &amp; Gouverneur Ln&quot; ~ 10043,
                             station_name == &quot;E 47 St &amp; 1 Ave&quot; ~ 10075,
                             station_name == &quot;Roebling St &amp; N 4 St&quot; ~ 11211,
                             TRUE ~ zipcode)) |&gt;
  left_join(y = (joined_uhf_34_42 |&gt; select(zip, uhf34, uhf34_neighborhood, borough)),
            by = join_by(&quot;zipcode&quot; == &quot;zip&quot;)) 

write_csv(stations, &quot;./citibike_clean/stations.csv&quot;)</code></pre>
</div>



</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeCodeFolding("hide" === "show");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
